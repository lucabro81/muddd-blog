---
interface Props {
  align: 'left' | 'right';
}

const { align } = Astro.props;
const { currentLocale } = Astro;
--- 

<div class={`language-switcher language-switcher--${align}`}>
  <a 
    href="#" 
    class={`language-switcher__item ${currentLocale === 'it' ? 'active' : ''}`}
    onclick="document.dispatchEvent(new CustomEvent('switch-lang', {detail: {language: 'it'}})); return false;">IT</a>
  <a 
    href="#" 
    class={`language-switcher__item ${currentLocale === 'en' ? 'active' : ''}`}
    onclick="document.dispatchEvent(new CustomEvent('switch-lang', {detail: {language: 'en'}})); return false;">EN</a>
</div>

<script>
    const ONE_YEAR_IN_MS = 365 * 24 * 60 * 60 * 1000;

    function manageLanguageSelection(e: Event, lang: string) {
      setLangCookie(lang);
      window.location.href = lang === 'it' ? '/' : `/${lang}`;
    }

    function setLangCookie(lang: string) {
      const hasConsent = document.cookie.split(';').some((item) => item.trim().startsWith('cookie_consent=true'));
      if (hasConsent) {
        const expires = new Date(Date.now() + ONE_YEAR_IN_MS).toUTCString();
        document.cookie = `lang=${lang}; path=/; expires=${expires}; SameSite=Lax`;
      }
    }

    document.addEventListener('switch-lang', (e: Event) => {
      const { language } = (e as CustomEvent<{ language: string }>).detail;
      manageLanguageSelection(e, language);
    });
    
</script>

<style>
  .language-switcher {
    display: flex;
    width: 100%;
    flex-direction: row;
    gap: 10px;
  }

  .language-switcher--right {
    justify-content: flex-end;
  }

  .language-switcher--left {
    justify-content: flex-start;
  }

  .active {
    text-decoration: none;
    pointer-events: none;
  }
</style>